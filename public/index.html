<!DOCTYPE html><html><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/><meta name="theme-color" content="#000"/><link rel="icon" type="image/png" href="i.png"/><link rel="manifest" href="m.json"/><title>Space4</title><style>:root{--b:#000;--pa:polygon(0% 0%,100% 0%,99% 95%,68% 94%,61% 100%,54% 95%,0 95%);--p:#ff2d95;--c:#675c60;--o:rgba(255,255,255,0);--i:#fff}*{margin:0;padding:0}html,body{background:var(--b);color:var(--i);font-family:Arial;overflow:hidden;position:fixed;user-select:none}div{box-sizing:border-box}.cs{align-items:center;display:flex;justify-content:center}.wh{width:100%;height:100%}#root{height:var(--h);justify-content:center;overflow:hidden;position:relative;width:var(--w);background:radial-gradient(ellipse at bottom,#1b2735 0%,#090a0f 100%)}a{color:var(--b);font-weight:700}a:visited{color:var(--b)}@keyframes aS{from{transform:translateY(-2000px)}to{transform:translateY(-150px)}}@keyframes bt{0%{transform:scale(0.8)}14%{transform:scale(1.5)}28%{transform:scale(0.8)}42%{transform:scale(1.5)}70%{transform:scale(0.8)}}@keyframes vs{from{transform:translateY(0)}to{transform:translateY(-90%)}}@keyframes bI{from,20%,40%,60%,80%,to{animation-timing-function:cubic-bezier(0.215,0.61,0.355,1)}0%{opacity:0;transform:scale3d(0.3,0.3,0.3)}20%{transform:scale3d(1.1,1.1,1.1)}40%{transform:scale3d(0.9,0.9,0.9)}60%{opacity:1;transform:scale3d(1.03,1.03,1.03)}80%{transform:scale3d(0.97,0.97,0.97)}to{opacity:1;transform:scale3d(1,1,1)}}@keyframes bD{0%{transform:translateY(-1200px) scale(0.7);opacity:.7}80%{transform:translateY(0px) scale(0.7);opacity:.7}100%{transform:scale(1);opacity:1}}.button{position:relative;margin:auto;padding-right:1.5rem;padding-left:1.5rem;font-size:1rem;line-height:3rem;text-decoration:none;color:var(--i);text-transform:uppercase;letter-spacing:2px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-image:linear-gradient(160deg,red,#ec008c);border-radius:30px;cursor:pointer;user-select:none;box-shadow:0 0 0 0 #ec008c,.5rem .5rem 30px #13092d;transition:box-shadow .6s}.button:hover{box-shadow:0 0 60px 2px #ec008c,.5rem .5rem 30px #13092d}.button:after{content:"";position:absolute;top:2px;right:2px;bottom:2px;left:2px;border-radius:30px;background-image:linear-gradient(170deg,rgba(255,255,255,0.3),var(--o));pointer-events:none}meteor{position:absolute;border-radius:100%;overflow:hidden;background:#bbacb0;background-image:radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,var(--c) 18%,var(--o) 19%),radial-gradient(circle,#81767a 60%,var(--o) 61%),radial-gradient(circle,#938c8f 60%,var(--o) 61%);background-repeat:no-repeat;background-size:89% 85%,60% 60%,30% 30%,15% 15%,15% 15%,15% 15%,23% 23%,120% 120%,120% 120%;background-position:-109% -82%,115% -5%,70% 42%,59% 7%,39% 52%,55% 87%,30% 77%,-60% 53%,0 53%}#m-g{transition:top .5s cubic-bezier(0.86,-0.02,0.45,1.35)}@keyframes cr{from{transform:rotate(0deg)}to{transform:rotate(-359deg)}}board{position:relative;animation:bI .5s both}holes{background:linear-gradient(to bottom,silver 0%,#b1b1b1 100%);border-radius:10px;box-shadow:inset 0 0 9px 6px #6c6b6b;display:block;position:absolute;z-index:1}holes > button{background:transparent;border:none;cursor:pointer;height:100%}board > meteor{transition:top .5s cubic-bezier(0.86,-0.02,0.45,1.35)}.p-r{transition:.35s stroke-dashoffset;transform:rotate(-90deg);transform-origin:50% 50%}avatar{flex-direction:column;position:relative}avimg,.avs{background:#bbacb0;border-radius:50%;border:5px solid var(--i);box-shadow:1px -1px 19px 1px var(--i);font-size:5rem;height:100px;overflow:hidden;text-align:center;width:100px}avimg.bl{animation:bl 1s linear infinite}.avatars{cursor:pointer;position:absolute;top:5%;width:100px;height:100px;opacity:0;font-size:40px;border-width:2px}avname a{color:var(--i)}.score{font-size:20px;margin-left:10px;font-weight:700;margin-top:10px}@keyframes bl{25%{box-shadow:0 0 30px 11px var(--turn)}75%{box-shadow:0 0 0 transparent}}.logo{font-size:60px;text-shadow:var(--i) 0 0 5px,var(--i) 0 0 10px,var(--i) 0 0 15px,var(--p) 0 0 20px,var(--p) 0 0 30px,var(--p) 0 0 40px,var(--p) 0 0 50px,var(--p) 0 0 75px;margin-bottom:30px;animation:bD .5s both}modal{position:absolute;top:0;left:0;z-index:100}modal.hide{pointer-events:none;visibility:hidden;transition:visibility 200ms}modal.show{visibility:visible}.ms,.mw{left:0;position:absolute;top:0}.ms{backdrop-filter:blur(5px);background:#b6b7c742}.mw{z-index:1}.mc{border-radius:5px;overflow:hidden;width:71%;background:var(--i);overflow:hidden}.mc .txt{color:#8f9cb5;padding:20px;flex-direction:column}.mb button{width:100%;border:none;height:50px;background:#fc7169;cursor:pointer;color:var(--i);text-transform:uppercase;font-weight:700}.mb button:nth-child(2){background:#b6bece}modal.show .mc{animation:fD 200ms both}modal.hide .mc{animation:fUp 200ms both}@keyframes fD{from{opacity:0;transform:translate3d(0,-100%,0)}to{opacity:1;transform:translate3d(0,0,0)}}@keyframes fUp{from{opacity:1}to{opacity:0;transform:translate3d(0,-100%,0)}}.chat{display:none;position:absolute;clip-path:var(--pa);width:280px;height:280px;top:-281px;left:-122px;background:#01866e;border-radius:10px;z-index:1}.chat.s{display:block}.chat button{border:none;cursor:pointer}.chat-msg{padding:10px}.chat-msg,.chat-emoji{width:100%;display:flex;justify-content:space-around;flex-flow:wrap}.chat-msg button{width:32%;font-size:10px;margin-bottom:5px;padding:7px;color:var(--i);border-radius:10px;background:#016e59}.chat-emoji button{background:none;font-size:2.1em;width:20%}bubble{visibility:hidden;position:absolute;background:var(--i);color:gray;font-family:Arial;font-weight:700;text-align:center;width:140px;height:50px;border-radius:9px;padding:0;top:120px;z-index:1;opacity:0;transition:opacity 1s,visibility 1s}bubble.show{visibility:visible;opacity:1}bubble:after{content:"";position:absolute;display:block;width:0;z-index:1;border-style:solid;border-color:var(--i) transparent;border-width:0 14px 10px;top:-10px;left:50%;margin-left:-14px}fieldset{background:rgba(255,255,255,0.1);box-shadow:0 8px 32px 0 rgba(31,38,135,0.37);backdrop-filter:blur(1px);border-radius:10px;border:1px solid rgba(255,255,255,0.18);padding:20px;margin:30px 0;animation:bI 1s both}fieldset form{display:flex}fieldset #code{border-radius:15px;border:none;font-size:30px;text-align:center;width:60%}#sounds,#sh,#back{background:none;border:none;cursor:pointer;font-size:2em;position:absolute;right:5%;top:3%}#sh,#back{left:5%}</style></head><body class="cs wh"><div id="root"></div><script src=socket.io/socket.io.js></script><script src=shared.js></script><script>let t,e,o,n;e=.3,t=(t=1,e=.05,i=220,a=0,s=0,r=.1,l=0,c=1,d=0,h=0,m=0,p=0,u=0,f=0,b=0,g=0,v=0,$=1,y=0,x=0)=>{let w,k,T=2*Math.PI,O=d*=500*T/n**2,S=(0<b?1:-1)*T/4,A=i*=(1+2*e*Math.random()-e)*T/n,M=[],E=0,j=0,P=0,z=1,L=0,I=0,C=0;for(h*=500*T/n**3,b*=T/n,m*=T/n,p*=n,u=n*u|0,k=(a=99+n*a)+(y*=n)+(s*=n)+(r*=n)+(v*=n)|0;P<k;M[P++]=C)++I%(100*g|0)||(C=l?1<l?2<l?3<l?Math.sin((E%T)**3):Math.max(Math.min(Math.tan(E),1),-1):1-(2*E/T%2+2)%2:1-4*Math.abs(Math.round(E/T)-E/T):Math.sin(E),C=(u?1-x+x*Math.sin(2*Math.PI*P/u):1)*(0<C?1:-1)*Math.abs(C)**c*t*.3*(P<a?P/a:P<a+y?1-(P-a)/y*(1-$):P<a+y+s?$:P<k-v?(k-P-v)/r*$:0),C=v?C/2+(v>P?0:(P<k-v?1:(k-P)/v)*M[P-v|0]/2):C),E+=(w=(i+=d+=h)*Math.sin(j*b-S))-w*f*(1-1e9*(Math.sin(P)+1)%2),j+=w-w*f*(1-1e9*(Math.sin(P)**2+1)%2),z&&++z>p&&(i+=m,A+=m,z=0),!u||++L%u||(i=A,d=O,z=z||1);return(t=o.createBuffer(1,k,n)).getChannelData(0).set(M),(i=o.createBufferSource()).buffer=t,i.connect(o.destination),i.start(),i},o=new(window.AudioContext||webkitAudioContext),n=44100,(()=>{const e=document.querySelector.bind(document),o=document.querySelectorAll.bind(document),n=4,i=["👩‍🚀","👩🏽‍🚀","👨‍🚀","👩🏻‍🚀","👨🏼‍🚀","👩🏼‍🚀","👩🏾‍🚀","👨🏽‍🚀","👨🏻‍🚀","👨🏿‍🚀","👩🏿‍🚀","👨🏾‍🚀"],a={beep:[2,.8,999,,,,,1.5,,.3,-99,.1,1.63,,,.11,.22],click:[,,539,0,.04,.29,1,1.92,,,567,.02,.02,,,,.04],win:[,,172,.8,,.8,1,.76,7.7,3.73,-482,.08,.15,,.14],ring:[,0,1600,.13,.52,.61,1,1.1,,,,,,.1,,.14],drop:[,,1e3,,,.5,,,,,99,.01,.03]},s=["blue","red"],r={msg:["TODAY IS YOUR DAY","WELL PLAYED","GOOG GAME","TODAY IS MY DAY","NICE MOVE","HEHEHEHE","OOPS!","THANKS","PLAY FAST","HI","YEAH","UNLUCKY"],emoji:["😝","🤓","😟","👊","👍","😨","😂","😭","🥰","🤬"]},l="share"in navigator;let c,d,h=!1;e("html").style.cssText+="--h: 732px; --w: 412px; --turn: red;";const m=(t,e)=>t.innerHTML=e,p=t=>Object.keys(t),u=()=>{const t=localStorage.getItem("space-four")||"";return""!==t?JSON.parse(t):{}},f=(t,e)=>{const o=u();var n;o[t]=e,n=o,localStorage.setItem("space-four",JSON.stringify(n))},b=(t="",e)=>u()[t]||e,g=(t,e,o,n={})=>{t&&t.addEventListener(e,o,n)},v=(t,e)=>{t&&e.split(" ").forEach(e=>{t.classList.add(e)})},$=(t,e)=>{t&&e.split(" ").forEach(e=>{t.classList.remove(e)})},y=(t,e)=>{if(t)for(let o in e)t.style[o]=e[o]},x=t=>p(t).length?`style='${p(t).map(e=>`${e}:${t[e]}`).join(";")}'`:"",w=(t,e)=>{var o;return function(){clearTimeout(o),o=setTimeout(t,e)}},k=w(()=>{const{w:t,h:o}={w:window.innerWidth,h:window.innerHeight},n=Math.min(t/412,o/732),i=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);y(e("body"),{zoom:(t<412?Math.round(t/412*100):100)+"%",transform:n>=1||i?`scale(${i?1:n})`:void 0})},50),T=t=>new Array(6).fill(null).map((e,o)=>new Array(7).fill(null).map((e,n)=>t(o,n))),O=t=>`brightness(40%) sepia(100%) hue-rotate(${1===t?183:-50}deg) saturate(600%)`,S=(t="",e="")=>`<a title=${t} href=${e} target="_blank" rel="noopener noreferrer">${t}</a>`,A=()=>({name:b("name",""),avatar:b("avatar",0),token:b("token","")}),M=t=>/^\d+$/.test(t)&&5===t.length,E=(t="",e="",o="",n="",i=0)=>{l?navigator.share({title:t,text:e,url:o}).then(()=>{I.show({icon:"🥰",txt:"<h2>Thanks for sharing</h2>",no:"",yes:"Ok",timer:2e3})}).catch(t=>{I.show({icon:"⚠️",txt:`<h2>Error</h2><p>${t}</p>`,no:"",yes:"Ok",timer:2e3})}):((t=>{const e=document.createElement("input");e.setAttribute("value",t),document.body.appendChild(e),e.select();document.execCommand("copy");document.body.removeChild(e)})(o),I.show({icon:"👍",txt:n,no:"",yes:"Ok",timer:i}))},j=()=>{if(e("#sounds")){const t="yes"===b("sounds","yes")?"no":"yes";f("sounds",t),e("#sounds").textContent="yes"===t?"🔊":"🔇"}},P=()=>E("Space4","Play Space4 #js13k 2021 edition by Jorge Rubiano @ostjh",location.href,"<h2>URL copied</h2><p>The url has been copied to your clipboard, share it with your friends</p>"),z={play(e="click",o=0){"yes"===b("sounds","yes")&&t(...a[e]),o&&(d=setInterval(()=>{"yes"===b("sounds","yes")&&t(...a[e])},2e3))},stop(){d&&clearInterval(d)}},L=({style:t={},id:e=""})=>`<meteor ${e?`id=${e} `:""}${x(t)}></meteor>`,I={show({txt:t,icon:o="",yes:n="yes",no:i="no",cb:a,timer:s=0}){e("modal .txt").innerHTML=(o?`<p ${x({"font-size":"3rem"})}>${o}</p>`:"")+t,y(e("modal #btn1"),{display:n?"block":"none"}),y(e("modal #btn2"),{display:i?"block":"none"}),e("modal #btn1").textContent=n,e("modal #btn2").textContent=i,$(e("modal"),"hide"),v(e("modal"),"show"),this.interval&&clearTimeout(this.interval),s&&(this.interval=setTimeout(()=>{this.hide()},s)),this.callback=a},hide(){$(e("modal"),"show"),v(e("modal"),"hide"),this.interval&&clearTimeout(this.interval)},render:()=>'<modal class="hide wh"><div class="ms wh"></div><div class="mw wh cs"><div class=mc><div class="wh cs txt"></div><div class="mb wh cs"><button id=btn1></button><button id=btn2></button></div></div></div></modal>',events(){o("modal button").forEach(t=>g(t,"click",t=>{this.hide(),this.callback&&this.callback("btn1"===t.target.id)}))}},C=t=>{const{isTwoPlayers:a=!1,isBot:l="",numMeteorites:d=n,isOnline:u={}}=t,f=A(),b=!(!a&&!l);let k=T(()=>[]),S=0,M=!1,E=b?randomNumber(1,2):u.playerStartsGame===f.token?1:2,P=E,C=b?!a&&2===E:2===E;const D=[],R=[{name:f.name,image:i[f.avatar],color:b?randomNumber(1,2):u.color,token:f.token,score:0}];if(R.push({name:b?a?"Guest":"Mr. Bot":u.p2.name,image:b?a?"👽":"🤖":i[u.p2.avatar],color:b?1===R[0].color?2:1:u.p2.color,token:b?"":u.p2.token,score:0}),b&&l)for(let t=d-1;t>=1;t--)D.push({c:s[R[1].color-1],i:t},{c:s[R[0].color-1],i:t});let Y,F,U={},J=!1;const W=()=>{Y&&clearInterval(Y),F&&clearTimeout(F);for(let t=0;t<R.length;t++)R[t].interval&&clearTimeout(R.interval)},_=(t="",o=0,n=1)=>{const i=e(`#pl-${n} bubble`);i.innerHTML=r[t][o],v(i,"show"),y(i,{"font-size":"msg"===t?"14px":"2em"}),R[n-1].interval&&clearTimeout(R[n-1].interval),R[n-1].interval=setTimeout(()=>{$(i,"show")},2e3)},X=(t=1,o=!0)=>{let n=100;const i=e(`#pl-${t} circle`),a=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=`${a} ${a}`,i.style.strokeDashoffset=""+a;const s=t=>{const e=a-t/100*a;i.style.strokeDashoffset=e};s(n),Y&&clearInterval(Y),o&&(Y=setInterval(()=>{if(s(n),n--,n<=50&&n%4==0&&z.play("beep"),n<0&&(clearInterval(Y),1===t)){const e=nt();tt(e,R[t-1].color)}},150))},K=t=>{const o={show:!1,txt:""};if(p(t.posible).length){const e=s[R[P-1].color-1];U[e]||(U[e]={});for(let o=d-1;o>=1;o--){const n="c-"+(d-o);U[e][n]||(U[e][n]=[]),t.posible[n].length&&(U[e][n]=[...new Set([...U[e][n],...t.posible[n]].map(t=>`${t[0]}${t[1]}`))].map(t=>t.split("").map(t=>+t)))}}if(t.connect){const n=t.meteorites.map(t=>k[t[0]][t[1]][1]);for(let t=0;t<=S;t++)y(e("#m-"+t),n.includes(t)?{animation:"bt 2s ease-out infinite","z-index":1}:{opacity:".5"});R[P-1].score+=1,e(`#pl-${P} .score`).innerHTML=R[P-1].score,o.show=!0,o.icon=R[P-1].image,o.txt=`<h2>${R[P-1].name} has won</h2><p>Do you want to play again?</p>`,z.play("win",2e3)}else 0!==ot().length?(M=!1,S++,P=1===P?2:1,C=b?!(!l||2!==P):2===P,et()):(o.show=!0,o.icon="🤝",o.txt="<h2>Tied game</h2><p>Do you want to play again?</p>");o.show&&(W(),I.show({...o,cb(t){z.stop(),b?t?at():V():t?(c.emit("action",{type:"pA",room:u.room,currentPlayer:f}),I.show({icon:"⏳",txt:`<h2 ${x({"text-align":"center"})}>Waiting for opponent's response</h2>`,no:"",yes:"Cancel",cb(){q(),V()}})):(q(),V())}}))},Q=(t,e)=>t>=0&&t<6&&e>=0&&e<7,Z=t=>{const e=+t[0],o=+t[1],n=k[e][o][0],i={v:[[e,o]]},a={};for(let t=e+1;t<6&&k[t][o][0]===n;t++)if(i.v.push([t,o]),i.v.length===d)return{connect:!0,posible:a,meteorites:i.v};i.h=[[e,o]];for(let t=1;t<=2;t++){let s=o+(1===t?-1:1);for(;Q(e,s)&&k[e][s][0]===n;)if(i.h.push([e,s]),s+=1===t?-1:1,i.h.length===d)return{connect:!0,posible:a,meteorites:i.h}}for(let t=1;t<=2;t++){const s=1===t?"id":"di";i[s]=[[e,o]];for(let r=1;r<=2;r++){const l={col:1===t?1===r?-1:1:1===r?1:-1,row:1===r?-1:1};let c=o+l.col,h=e+l.row;for(;Q(h,c)&&k[h][c][0]===n;)if(i[s].push([h,c]),h+=l.row,c+=l.col,i[s].length===d)return{connect:!0,posible:a,meteorites:i[s]}}}if(l&&("medium"===l||"hard"===l))for(let t=d-1;t>=1;t--){const n="c-"+(d-t);if(a[n]=[],i.h.length===d-t){const t=i.h.map(t=>t[1]).sort(),o={left:t[0]-1,right:t[t.length-1]+1};for(let t=1;t<=2;t++){const i=1===t?"left":"right";Q(e,o[i])&&0===k[e][o[i]].length&&a[n].push([e,o[i]])}}if(i.v.length===d-t){const t=i.v[0][0]-1;Q(t,o)&&0===k[t][o].length&&a[n].push([t,o])}for(let e=1;e<=2;e++){const o=1===e?"id":"di";if(i[o].length===d-t){const t=i[o].sort((t,e)=>t[0]-e[0]);for(let o=1;o<=2;o++){const i=t[1===o?0:t.length-1],s=i[0]+(1===o?-1:1),r=i[1]+(1===e?1===o?-1:1:1===o?1:-1);Q(s,r)&&0===k[s][r].length&&a[n].push([s,r])}}}}return{connect:!1,posible:a}},tt=(t=0,o=1)=>{const n=k.map(e=>e[t]).filter(t=>!t.length).length-1;if(M||n<0)return;e("#turn").innerHTML="...",z.play("drop");const i=e("#m-"+S);k[n][t]=[o,S],i.setAttribute("p",`${n}-${t}`),y(i,{left:9+50*t+"px",top:"-59px",filter:O(o),visibility:"visible",animation:"cr 5s infinite linear"}),setTimeout(()=>{i&&y(i,{top:9+50*n+"px"})},100),M=!0,b||(X(P,!1),1===P&&c.emit("action",{type:"drop",currentPlayer:f,room:u.room,index:t,color:o})),J=!1,F&&clearTimeout(F),F=setTimeout(()=>{J=!0,i&&y(i,{top:9+50*n+"px"}),K(Z([n,t]))},2e3)},et=()=>{document.documentElement.style.setProperty("--turn",s[R[P-1].color-1]);const t=1===P?2:1;v(e(`#pl-${P} avimg`),"bl"),$(e(`#pl-${t} avimg`),"bl"),e("#turn").innerHTML=1===P?"You turn":"Opponent's turn",l&&2===P&&it(),b||X(P)},ot=()=>{const t=[];for(let e=0;e<7;e++){let o=0;for(let t=0;t<6;t++)o+=+(0===k[t][e].length);0!==o&&t.push(e)}return t},nt=()=>{const t=ot();return t[randomNumber(0,t.length-1)]},it=w(()=>{let t=nt(),e=!1;const o="easy"!==l&&("medium"!==l||!!randomNumber(0,1));if(0!==p(U).length&&o)for(let o of D)if(U[o.c]){const a=U[o.c]["c-"+o.i],s=[];if(0!==a.length)for(let o=0;o<a.length;o++)if(0===k[a[o][0]][a[o][1]].length){if(n=a[o][0],i=a[o][1],n+1===6||0!==k[n+1][i].length){t=a[o][1],s.push(o),e=!0;break}}else s.push(o);for(let t=0;t<s.length;t++)U[o.c]["c-"+o.i].splice(s[t],1);if(e)break}var n,i;tt(t,R[P-1].color)},500),at=()=>{k=T(()=>[]),o("board > meteor").forEach(t=>{t.style="",y(t,{width:"31.5px",height:"31.5px",visibility:"hidden"})}),S=0,M=!1,E=1===E?2:1,P=E,C=b?!a&&2===E:2===E,U={},J=!1,W(),et(),z.stop()};m(e("#render"),`<div class='wh cs' ${x({"flex-direction":"column","z-index":3})}>${B()}${N()}${((t=[],e=!1)=>`<div class=cs ${x({width:"100%",margin:"30px 0"})}>${t.map((t,o)=>`<div ${x({width:"100%",display:"flex","justify-content":"center","flex-direction":"column","align-items":"center",position:"relative",animation:`b-${o?"right":"left"} 0.8s both`})} id=pl-${o+1}>${e?`<svg class="p-r" width="120" height="120" ${x({position:"absolute","z-index":1,top:"11px",transform:"scale(0.7)"})}><circle class="progress-ring__circle" stroke="${s[t.color-1]}" stroke-width="12" fill="transparent" r="52" cx="60" cy="60"/></svg><bubble class=cs></bubble>`:""}${G({name:t.name,styles:{"margin-bottom":"10px","font-size":"18px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","text-align":"center",width:"120px"}})}${H({image:t.image,styles:{width:"70px",height:"70px","font-size":"3.5rem"}})}<div class=cs>${L({style:{filter:O(t.color),width:"20px",height:"20px",position:"relative","margin-top":"10px",animation:"cr 3s infinite linear"}})}<div class=score>0</div></div></div>`).join("")}</div>`)(R,!b)}<div id=turn ${x({"font-size":"25px","margin-bottom":"30px"})}></div><board ${x({width:"350px",height:"300px"})}><holes class=wh ${x({"-webkit-mask-image":"radial-gradient(transparent 50%, #fff 50%)","-webkit-mask-size":"50px 50px","-webkit-mask-position":"50px 50px"})}>${new Array(7).fill(null).map((t,e)=>`<button id='h-${e}' ${x({width:"50px"})}></button>`).join("")}</holes>${T((t,e)=>L({id:"m-"+(e+7*t),style:{width:"31.5px",height:"31.5px",visibility:"hidden"}})).map(t=>t.join("")).join("")}</board>${b?"":`<chat ${x({"margin-top":"30px",position:"relative","z-index":1})}><div class=chat>${p(r).map(t=>`<div class=chat-${t}>${r[t].map((e,o)=>`<button id="${t}-${o}">${e}</button>`).join("")}</div>`).join("")}</div><button class=button>Chat</button></chat>`}</div>`),b||(g(e("chat .button"),"click",()=>{e(".chat").classList.toggle("s")}),o(".chat button").forEach(t=>{g(t,"click",t=>{const o=t.target.id.split("-");_(o[0],+o[1]),c.emit("action",{type:"chat",room:u.room,currentPlayer:f,value:o}),$(e(".chat"),"s")})})),o("holes > button").forEach(t=>g(t,"click",t=>!C&&tt(+t.target.id.split("-")[1],R[P-1].color))),o("board > meteor").forEach(t=>{return e=t=>{F&&clearTimeout(F),J||K(Z(t.target.getAttribute("p").split("-")))},g(t,"transitionend",t=>e(t));var e}),g(e("#back"),"click",()=>{I.show({icon:"⚠️",txt:`<h2 ${x({"margin-bottom":"10px"})}>Exit game</h2><p>Are you sure you want to finish the game?</p>`,cb(t){t&&(W(),b||q(),V())}})}),g(e("#sounds"),"click",j),h&&c&&(c.on("action",t=>{if(t.currentPlayer.token!==f.token){const{type:e=""}=t;"drop"===e&&(M=!1,J=!1,W(),tt(t.index,t.color)),"pA"===e&&(z.stop(),I.show({icon:"😃",txt:`<h2 ${x({"text-align":"center"})}>Your opponent wants to play again</h2>`,cb(t){t?(c.emit("action",{type:"at",room:u.room,currentPlayer:f}),at()):(q(),V())}})),"at"===e&&(I.hide(),at()),"chat"===e&&_(t.value[0],+t.value[1],2)}}),c.on("pD",()=>{W(),q(),V(),I.show({icon:"😩",txt:`<h2 ${x({"margin-bottom":"10px"})}>User disconnected</h2><p>Your partner has left the room</p>`,no:"",yes:"Ok",timer:2e3})})),et()},N=()=>"<button id=back>⬅️</button>",D=()=>{m(e("#render"),`<div class='cs' ${x({"flex-direction":"column"})}>${N()}${R()}<h2 ${x({margin:"30px 0","text-align":"center","text-transform":"uppercase"})}>CHOOSE DIFFICULTY</h2>${["Easy","Medium","Hard"].map((t,e)=>`<button class=button id=${t.toLowerCase()} ${x({width:"150px","margin-bottom":"20px",animation:`bI ${.5*e+.5}s both`})}>${t}</button>`).join("")}</div>`),o(".button").forEach(t=>g(t,"click",t=>V("Game",{isBot:t.target.id}))),g(e("#back"),"click",()=>V())},R=()=>"<h1 class=logo>Space4</h1>",H=({image:t="",styles:e={}})=>`<avimg ${x(e)}>${t}</avimg>`,G=({name:t="",edit:e=!1,styles:o={}})=>`<avname ${x(o)}>${e?`<a href="#">${t}</a>`:t}</avname>`,Y=({name:t,stylesImage:e={},stylesName:o={},avatar:n={},edit:a=!1})=>`<avatar class=cs>${H({image:n.image,styles:e})}${G({name:t,styles:o,edit:a})}${a?` <select class=avatars>${i.map((t,e)=>`<option value=${e}${n.index===e?" selected":""}>${t}</option>`).join("")}</select>`:""}</avatar>`,F=(t={})=>{const o=A(),n={"margin-top":"15px","font-weight":"bold","font-size":"15px"};m(e("#render"),`<div class=cs ${x({"flex-direction":"column",width:"100%","z-index":5})}>${B()}${N()}${R()}<div class="cs" ${x({margin:"50px 0",width:"90%","justify-content":"space-around"})}>${Y({name:o.name,avatar:{image:i[o.avatar],index:o.avatar},stylesImage:{width:"70px",height:"70px","font-size":"3.5rem"},stylesName:n})}<h1>Vs</h1><div id="vs" class=cs ${x({"flex-direction":"column"})}><div class=avs ${x({width:"80px",height:"80px",overflow:"hidden",position:"relative"})}><div class=cs ${x({"flex-direction":"column",position:"absolute",top:0,left:0,width:"100%",animation:"vs 1.5s infinite linear","font-size":"3.5rem"})}>${i.map(t=>t).join("")}</div></div>${G({name:"Searching...",styles:n})}</div></div>${t.createRoom?`<div ${x({width:"90%"})}><fieldset class=cs ${x({"margin-top":0,"flex-direction":"column"})}><legend>Play with Friends</legend><code ${x({"font-size":"50px","font-weight":"bold","margin-bottom":"10px","text-align":"center"})}>${t.friendRoom}</code><button id=share class=button ${x({"margin-bottom":"20px"})}>Share Room</button><p>Share this room code to play with your friend</p></fieldset></div>`:""}<button id=cancel class=button>Cancel</button></div>`);const a=()=>{V(),q()};g(e("#back"),"click",a),g(e("#cancel"),"click",a),g(e("#sounds"),"click",j),z.play("ring",2e3),t.createRoom&&g(e("#share"),"click",()=>{E("Space4","Come Play a Space4 match with me :)",`${location.href}?room=${t.friendRoom}`,"<h2>URL copied</h2><p>The URL of the room has been copied into your clipboard</p>",2e3)}),K(t)},U=()=>{m(e("#render"),`<div class=cs ${x({"flex-direction":"column",width:"100%","z-index":5})}>${N()}${R()}${[{legend:"Please enter the five room code",html:'<form><input type="tel" id="code" autocomplete="off"><button type="submit" class=button>JOIN</button></form>'},{legend:"Create a private room",html:"<button class=button>CREATE</button>"}].map((t,e)=>`<div id=f-${e} ${x({width:"80%"})}><fieldset class=cs><legend>${t.legend}</legend>${t.html}</fieldset></div>${0===e?"<h2>OR</h2>":""}`).join("")}</div>`),g(e("#back"),"click",()=>V()),g(e("form"),"submit",t=>{t.preventDefault();const o=e("#code").value;M(o)?V("SearchOpponent",{friendRoom:o,type:"friend"}):I.show({icon:"⚠️",txt:"<h2>Invalid code</h2><p>The code of the room must be a number and five characters</p>",no:"",yes:"Ok"})}),g(e("#f-1 button"),"click",()=>{V("SearchOpponent",{createRoom:!0,friendRoom:randomNumber(1e4,99999),type:"friend"})})},B=()=>`<button id=sounds>${"yes"===b("sounds","yes")?"🔊":"🔇"}</button>`,J=()=>{const t=A();m(e("#render"),`<div class=cs ${x({"flex-direction":"column","z-index":5})}><button id=sh>🚀</button>${B()}${R()}${Y({name:t.name,avatar:{image:i[t.avatar],index:t.avatar},stylesName:{"margin-top":"15px","font-weight":"bold","font-size":"25px"},edit:!0})}<div class='cs options' ${x({"flex-direction":"column","margin-top":"25px"})}>${[["Two Players","two"],["Vs Bot","bot"],["Play with friends","friend"],["Play Online","online"]].map((t,e)=>`<button class=button id=${t[1]} ${x({width:"260px","margin-bottom":"20px",animation:`bI ${.5*e+.5}s both`})}>${t[0]}</button>`).join("")}</div><a id="about" ${x({color:"white","z-index":2,"font-size":"20px"})} href="#">About</a></div>`),g(e("#about"),"click",t=>{t.preventDefault(),I.show({txt:`<p ${x({"font-size":"3rem","margin-bottom":"10px"})}>👨🏻‍💻</p><p>Game developed by Jorge Rubiano for the 2021 edition of ${S("#js13k","https://js13kgames.com/")}</p><div class=wh ${x({padding:"15px"})}><ul>${[["Twitter","https://twitter.com/ostjh"],["Github","https://bit.ly/3n6ufYc"]].map(t=>`<li ${x({"margin-bottom":"5px"})}>${S(t[0],t[1])}</li>`).join("")}</ul></div>`,yes:"Ok",no:""})}),o(".options > button").forEach(t=>{g(t,"click",t=>{const e=t.target.id;"two"===e?V("Game",{isTwoPlayers:!0}):V({bot:"Difficulty",online:"SearchOpponent",friend:"PlayFriends"}[e])})}),g(e(".avatars"),"change",t=>{m(e("avimg"),i[t.target.value]),f("avatar",+t.target.value)}),g(e("avname a"),"click",t=>{t.preventDefault();const o=sTag(prompt("Write your name",b("name","")));if(o){const t=o.length>10?o.substring(0,10)+"...":o;e("avname a").textContent=t,f("name",t)}}),g(e("#sounds"),"click",j),g(e("#sh"),"click",P)},V=(t="Lobby",o={})=>{const n={Lobby:J,Game:C,Difficulty:D,SearchOpponent:F,PlayFriends:U};z.stop(),n[t](o),y(e("#m-g"),{top:"Game"===t?"732px":"567.2px"})},W=[600,300,200].map((t,e)=>`.star-${e} {width: 1px; height: 1px; background: transparent; box-shadow: ${new Array(t).fill(null).map(()=>`${randomNumber(1,2e3)}px ${randomNumber(1,2e3)}px #FFF`).join(",")}; animation : aS ${50*e+50}s linear infinite;}`).join(""),_=["left","right"].map((t,e)=>`@keyframes b-${t} {0% { transform: translateX(${2e3*(e?1:-1)}px) scale(0.7); opacity: 0.7; } 80% { transform: translateX(0px) scale(0.7); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; }}`).join(""),X=document.createElement("style");m(X,_+W),e("head").appendChild(X),m(e("#root"),`${I.render()}<div id="render" class="wh cs"></div>${new Array(3).fill(null).map((t,e)=>`<div class='star-${e}'></div>`).join("")}${L({id:"m-g",style:{width:"412px",height:"412px",top:"567.2px","z-index":1,animation:"cr 60s infinite linear"}})}`),I.events(),g(e("#root"),"click",t=>{const e=t.target,o=e.id||"";["A","BUTTON"].includes(e.nodeName)&&0===["h-","msg-","emoji-"].filter(t=>o.includes(t)).length&&z.play()});const q=()=>{h&&c&&(h=!1,c.disconnect())},K=(t={})=>{c=io(),h=!0,c.on("connect",()=>{c.emit("nU",{...t,player:A()},t=>{t&&(V("PlayFriends"),q(),I.show({icon:"⚠️",txt:`<h2>${t}</h2>`,no:"",yes:"Ok",timer:2e3}))})}),c.on("connect_error",()=>{V(),q(),I.show({icon:"🔌",txt:"<h2>Error connecting to server</h2>",no:"",yes:"Ok",timer:2e3})}),c.on("sG",t=>{const e=t.p1.token===A().token?"p1":"p2";V("Game",{isOnline:{room:t.room,playerStartsGame:t.playerStartsGame,color:t[e].color,p2:t["p1"===e?"p2":"p1"]}})})};p(u()).length||(f("name","Astronaut "+randomNumber(100,999)),f("avatar",randomNumber(0,i.length-1)),f("token",guid()));const Q={screen:"Lobby",param:{}},Z=(()=>{let t=[];const e=window.location.search;return"?"===e[0]&&(t=e.slice(1).split("&").map(t=>{let e,o;return[e,o]=t.split("="),{key:e,value:o}})),t})();if(0!==Z.length){const t=Z.filter(t=>"room"===t.key);if(t.length){const e=t[0].value||"";M(e)&&(Q.screen="SearchOpponent",Q.param={friendRoom:e,type:"friend"})}history.replaceState({},document.title,location.protocol+"//"+location.host+location.pathname)}V(Q.screen,Q.param),g(document,"contextmenu",t=>t.preventDefault()),g(window,"resize",k),k()})();"serviceWorker"in navigator?navigator.serviceWorker.register("sw.js").then(()=>{console.log('ok')}).catch(()=>{console.log('fail')}):console.log('error');</script></body></html>